<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title>Editor20 &laquo; Documentation &laquo; PlugBoard</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <style media="screen" type="text/css">@import url('../s/site.css');</style>
  <link media="print" href="../s/print.css" rel="stylesheet"
 type="text/css" />
</head>
<body id="docs-page">
<div id="main">
<div class="hidden"><a href="#content">Skip to content</a></div>
<div id="header">
<h1><span>PlugBoard,
the flexible framework to create plugin-based
applications.</span></h1>
<div id="top-nav">
<ul>
  <li><a id="a_home" href="/">Home</a></li>
  <li><a id="a_about" href="../about/">About</a></li>
  <li><a id="a_install" href="../install/">Install</a></li>
  <li><a id="a_docs" href="../docs/">Documentation</a></li>
  <li><a id="a_dev" href="../development/">Development</a></li>
</ul>
<form action="http://www.google.com/custom" method="get"> <input
 name="sitesearch" value="plugboard.berlios.de" type="hidden" /><!-- style="vertical-align: middle" -->
Search site with Google <input onfocus="this.select();" size="20"
 maxlength="255" name="q" value="" type="text" /> </form>
</div>
</div>
<div id="content">

<h2>How to create a flexible editor</h2>
<h3>1. Introduction</h3>
<p>This tutorial explains how to
get working most of all PlugBoard components toghether.</p>
<p>This document would like to be a first shot example made step by step for all parts of, so its target
are mainly new comers to PlugBoard.</p>
<p>However, before using this framework then understand this tutorial, you <b>must</b>
know the <a href="http://www.zope.org/Products/ZopeInterface/">zope.interface</a>
and <a href="http://peak.telecommunity.com/DevCenter/setuptools">setuptools</a> libraries.</p>
<div class="note">
<h3>Note</h3>
<p>This tutorial uses some components which need to be able to access Python library path
(for instance <code>site-packages</code>).</p>
<p>We will use an XML config and <a href="http://www.pygtk.org">PyGTK 2.8</a>
</div>

<h3>2. Creating the project</h3>
<p>Now let's create the skeleton directory structure:</p>
<pre>plugboardctl.py create PlugEditor</pre>
<p>Notice how this script created for you the <code>setup.py</code> file specifying inside the
current version of PlugBoard as dependency and a starting entrypoint
string for our application plugins.</p>

<h3>3. The main file</h3>
<p>PlugBoard, as described in the <a href="architecture.html">architecture document</a>, offers
an <code>IApplication</code> interface which is the principal component of an application.</p>
<p>Its implementation is found at <code>plugboard.application.Application</code>, so let's edit <code>plugeditor/main.py</code></p>
<pre>
<font color="blue">from</font> plugboard <font color="blue">import</font> application

<font color="blue">def</font> main():
&nbsp;&nbsp;app = application.Application()
</pre>
<p>Now we created our <code>IApplication</code> implementation instance. After that, we said in <code>setup.py</code> there's a string which defines a Python path for plugin entrypoints, for instance <b><code>plugeditor.plugins</code></b>. So, since we are using a setuptools-based plugin management to find installed plugins, install the <code>IPluginResource</code> as follows:
<pre>
<font color="blue">from</font> plugboard <font color="blue">import</font> application, plugin

<font color="blue">def</font> main():
&nbsp;&nbsp;app = application.Application()
&nbsp;&nbsp;pr = plugin.SetuptoolsPluginResource(app, '<font color="grey">plugeditor.plugins</font>')
&nbsp;&nbsp;pr.refresh()
</pre>
<p><code>SetuptoolsPluginResource</code> is a builtin implementation of <code>IPluginResource</code>, which accepts as the first argument the plugin entrypoint path. The method call <code>pr.refresh()</code> is used the retrieve the list of plugins from the given entrypoint path.</p>
<div class="note">
<h3>Note</h3>
<p>The <code>refresh(entrypoint_path=None)</code> method accepts a keyword argument for specifying the entrypoint path for plugins. If no path has been given, it uses the one specified at the initialization.</p>
<p>It also clears the plugins list before retrieving them again from the given entrypoint path.</p>
</div>
Once you have been done this, we can start writing plugins. In this kind of application, i chose to make the core (for instance the main window and other related things) as a plugin itself, so it could be changed as well using other implementations.

<h3>4. The main window plugin</h3>
<h3>4.1 The interface</h3>
<p>Ok, now let's create the main window interface of the editor in <code>plugeditor/plugins/interfaces.py</code>:
<pre>
<font color="blue">from</font> plugboard.plugin <font color="blue">import</font> IPlugin
<font color="blue">import</font> gtk

<font color="blue">class</font> IMainWindowPlugin(IPlugin):
&nbsp;&nbsp;<font color="blue">def</font> get_window():
&nbsp;&nbsp;&nbsp;&nbsp;"""
&nbsp;&nbsp;&nbsp;&nbsp;<font color="grey">Returns the main window widget</font>
&nbsp;&nbsp;&nbsp;&nbsp;"""
&nbsp;&nbsp;get_window.return_type = gtk.Window
</pre>
<p>Creating an interface for the main window plugin let the application to be very flexible for switching from an implementation to another.</p>
<p>In the code above, we declare a class deriving from <code>IPlugin</code> which contains common methods and informations regarding plugins. The <code>get_window.return_type = gtk.Window</code> directive is just an information for developers who want to create an <code>IMainWindowPlugin</code> implementation.</p>
<div class="note">
<h3>Note</h3>
<p>If you don't know which declaring component of zope.interface the assignment to <code>get_window.return_type</code> is, please read the zope.interface documentation. This is called <b>tag</b>, used to add extra informations over an attribute or method.</p>
</div>

<h3>4.2 The implementation</h3>
<p>Now, we need to implement <code>IMainWindowPlugin</code>, then write this code in <code>plugeditor/plugins/core.py</code>:</p>
<pre>
<font color="blue">from</font> plugboard <font color="blue">import</font> plugin
<font color="blue">from</font> zope.interface <font color="blue">import</font> implements
<font color="blue">import</font> interfaces, gtk

<font color="blue">class</font> MainWindowPlugin(plugin.Plugin):
&nbsp;&nbsp;implements(interfaces.IMainWindowPlugin)

&nbsp;&nbsp;<font color="blue">def</font> __init__(self, application):
&nbsp;&nbsp;&nbsp;&nbsp;self.widget = gtk.Window()
&nbsp;&nbsp;&nbsp;&nbsp;self.widget.set_title("<font color="grey">PlugEditor</font>")

&nbsp;&nbsp;<font color="blue">def</font> load(self, context):
&nbsp;&nbsp;&nbsp;&nbsp;self.widget.show_all()

&nbsp;&nbsp;<font color="blue">def</font> get_widget(self):
&nbsp;&nbsp;&nbsp;&nbsp;<font color="blue">return</font> self.widget
</pre>
<p>The initialization just set the instance variable <code>widget</code> value, while on loading the window will be shown.</p>
<div class="note">
<h3>Note</h3>
<p>If you don't know how a plugin is loaded into the application, please read the <a href="architecture.html">PlugBoard architecture documentation</a></p>
</div>
<p>Once we done this, we should add this new plugin to the entrypoint, so that <code>SetuptoolsPluginResource</code> can find it. Edit then the entrypoints in <code>setup.py</code> as follows:</p>
<pre>
entry_points="""<font color="grey">
[plugeditor.plugins]
MainWindowPlugin = plugeditor.plugins.core:MainWindowPlugin    
</font>"""
</pre>
<p>The first name <code>MainWindowPlugin</code> is not important for the purposes of <code>SetuptoolsPluginResource</code>, however it could be a good idea to keep the name always clear because of other <code>IPluginResource</code> implementations for setuptools which could need it.</p>

<h3>5. The context resource</h3>
<p><i>coming soon</i></p>

<div id="footer">
<p><a href="#main">Top^</a>
| All contents by <a href="http://www.deelan.com">deelan</a>,
<a href="http://creativecommons.org/licenses/by-sa/2.5/">some
rights
reserved</a> | Page last modified
Feb 15, 2006</p>

</div>
</div>
</body>
</html>
